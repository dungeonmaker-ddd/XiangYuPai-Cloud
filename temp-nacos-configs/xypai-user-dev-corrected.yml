# XyPai User Service 正确配置
# Data ID: xypai-user-dev.yml
# Group: DEFAULT_GROUP
# 请将此配置上传到Nacos配置中心

# 动态数据源配置
spring:
  datasource:
    dynamic:
      # 设置默认的数据源或者数据源组,默认值即为 master
      primary: master
      # 严格匹配数据源,默认false. true未匹配到指定数据源时抛异常,false使用默认数据源
      strict: false
      datasource:
        master:
          url: jdbc:mysql://127.0.0.1:3306/ry-cloud?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
          username: root
          password: root123
          driver-class-name: com.mysql.cj.jdbc.Driver
          # 初始连接数
          initial-size: 10
          # 最小连接池数量
          min-idle: 10
          # 最大连接池数量
          max-active: 200
          # 配置获取连接等待超时的时间
          max-wait: 60000
          # 配置连接超时时间
          connect-timeout: 30000
          # 配置网络超时时间
          socket-timeout: 60000
          # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒
          time-between-eviction-runs-millis: 60000
          # 配置一个连接在池中最小生存的时间，单位是毫秒
          min-evictable-idle-time-millis: 300000
          # 配置一个连接在池中最大生存的时间，单位是毫秒
          max-evictable-idle-time-millis: 900000
          # 配置检测连接是否有效
          validation-query: SELECT 1 FROM DUAL
          test-while-idle: true
          test-on-borrow: false
          test-on-return: false
          # 打开PSCache，并且指定每个连接上PSCache的大小
          pool-prepared-statements: true
          max-pool-prepared-statement-per-connection-size: 20
          # 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙
          filters: stat,slf4j
          # 通过connectProperties属性来打开mergeSql功能；慢SQL记录
          connection-properties: druid.stat.mergeSql\=true;druid.stat.slowSqlMillis\=5000

# MyBatis Plus配置
mybatis-plus:
  configuration:
    # 自动驼峰命名规则（camel case）映射
    map-underscore-to-camel-case: true
    # 当映射结果为null时是否调用映射对象的setter方法
    call-setters-on-nulls: true
    # 开发环境打印SQL
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      # 逻辑删除配置
      logic-delete-field: delFlag
      logic-delete-value: 1
      logic-not-delete-value: 0
      # 自动填充配置
      insert-strategy: not_null
      update-strategy: not_null

# 日志配置
logging:
  level:
    com.xypai.user: debug
    org.springframework.cloud: warn
    org.springframework.web: info
    org.springframework.security: warn
    org.springframework.boot.autoconfigure: warn
    com.alibaba.druid: debug

# 监控端点配置
management:
  endpoints:
    web:
      exposure:
        include: '*'
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: ${spring.application.name}

# Swagger配置
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
  info:
    title: XyPai User Service API
    description: 相遇派用户中心服务接口文档
    version: 3.6.6
    contact:
      name: XyPai Team
      url: http://www.xypai.vip
      email: admin@xypai.vip

# Knife4j配置
knife4j:
  enable: true
  setting:
    language: zh_cn
    enable-search: true
    enable-debug: true
  basic:
    enable: false
    username: admin
    password: admin123

# 用户业务配置
user:
  config:
    # 默认密码
    default-password: "123456"
    # 密码重试次数
    password-retry-limit: 5
    # 账号锁定时间（分钟）
    account-lock-time: 10
