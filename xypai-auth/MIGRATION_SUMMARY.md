# ğŸš€ è®¤è¯æ¨¡å—é‡æ„è¿ç§»æ€»ç»“

## ğŸ“Š é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å°† `auth-app` æ¨¡å—ä¸­çš„è®¤è¯ç›¸å…³åŠŸèƒ½å®Œå…¨è¿ç§»åˆ° `auth-app-auth` æ¨¡å—ï¼Œå®ç°äº†ï¼š

- **èŒè´£åˆ†ç¦»**ï¼š`auth-app` ä¸“æ³¨ä¸šåŠ¡åŠŸèƒ½ï¼Œ`auth-app-auth` ä¸“æ³¨è®¤è¯æœåŠ¡
- **æ¶æ„è§£è€¦**ï¼šç§»é™¤Feignä¾èµ–ï¼Œæ”¹ç”¨RestTemplateç›´æ¥è°ƒç”¨
- **æœåŠ¡å†…èš**ï¼šè®¤è¯ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨è®¤è¯æ¨¡å—

## ğŸ”„ é‡æ„å‰åå¯¹æ¯”

### é‡æ„å‰

```
auth-app/
â”œâ”€â”€ client/               âŒ è®¤è¯å®¢æˆ·ç«¯ï¼ˆéœ€è¿ç§»ï¼‰
â”‚   â”œâ”€â”€ AuthServiceClient.java
â”‚   â””â”€â”€ AuthServiceClientFallback.java
â”œâ”€â”€ controller/           âœ… ä¸šåŠ¡åŠŸèƒ½ï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ AppBusinessController.java
â””â”€â”€ XyPaiAuthAppBusinessApplication.java

auth-app-auth/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ AuthController.java     # ä»…å†…éƒ¨ä½¿ç”¨
â”œâ”€â”€ service/
â””â”€â”€ strategy/
```

### é‡æ„å

```
auth-app/                    ğŸ¯ çº¯ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ AppBusinessController.java    # APPä¸šåŠ¡åŠŸèƒ½
â”œâ”€â”€ service/
â”‚   â””â”€â”€ AuthApiService.java           # å†…éƒ¨è®¤è¯è°ƒç”¨æ”¯æŒï¼ˆç²¾ç®€ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ RestTemplateConfig.java       # HTTPå®¢æˆ·ç«¯é…ç½®
â””â”€â”€ XyPaiAuthAppBusinessApplication.java

auth-app-auth/              ğŸ” å®Œæ•´è®¤è¯æœåŠ¡
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ AuthController.java           # åŸæœ‰è®¤è¯æ¥å£
â”‚   â””â”€â”€ AuthClientController.java     # å¯¹å¤–æœåŠ¡æ¥å£ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ service/
â””â”€â”€ strategy/
```

## âœ¨ æ–°å¢åŠŸèƒ½ç‰¹æ€§

### 1. **AuthClientController** - å¯¹å¤–æœåŠ¡æ¥å£

- **è·¯å¾„**: `/client/auth/*`
- **åŠŸèƒ½**: ä¸ºå…¶ä»–ä¸šåŠ¡æ¨¡å—æä¾›è®¤è¯æœåŠ¡
- **ç‰¹ç‚¹**:
    - ç»Ÿä¸€çš„å¯¹å¤–æ¥å£
    - å®Œå–„çš„é”™è¯¯å¤„ç†
    - æ ‡å‡†çš„RESTè®¾è®¡

### 2. **AuthApiService** - å†…éƒ¨è®¤è¯è°ƒç”¨æ”¯æŒ

- **åŠŸèƒ½**: ä¸ºä¸šåŠ¡é€»è¾‘æä¾›è®¤è¯æœåŠ¡çš„å†…éƒ¨è°ƒç”¨æ”¯æŒ
- **ä½¿ç”¨åœºæ™¯**:
    - ä¸šåŠ¡æµç¨‹ä¸­éªŒè¯ç”¨æˆ·èº«ä»½
    - è·å–ç”¨æˆ·ä¿¡æ¯è¿›è¡Œä¸šåŠ¡å¤„ç†
    - å†…éƒ¨æœåŠ¡é—´è®¤è¯çŠ¶æ€æ£€æŸ¥
- **ç‰¹ç‚¹**:
    - çµæ´»çš„è¶…æ—¶é…ç½®
    - å®Œå–„çš„é™çº§ç­–ç•¥
    - è¯¦ç»†çš„æ—¥å¿—è®°å½•

## ğŸ”§ é…ç½®å˜æ›´

### auth-appé…ç½®æ›´æ–°

```yaml
# ç§»é™¤Feigné…ç½®
# feign: ...

# æ–°å¢è®¤è¯æœåŠ¡é…ç½®
auth:
  service:
    url: ${AUTH_SERVICE_URL:http://xypai-auth-app-auth:8101}
    timeout:
      connect: 3000
      read: 10000
```

### ä¾èµ–å˜æ›´

- âŒ ç§»é™¤: `@EnableRyFeignClients`
- âœ… æ–°å¢: `RestTemplate` é…ç½®
- âœ… æ–°å¢: è®¤è¯æœåŠ¡URLé…ç½®

## ğŸ“Š æ¥å£æ˜ å°„å…³ç³»

| åŸFeignæ¥å£     | æ–°RestTemplateè°ƒç”¨                       | å¯¹å¤–ä»£ç†æ¥å£            |
|--------------|---------------------------------------|-------------------|
| `/login`     | `AuthApiService.login()`              | `/auth/login`     |
| `/login/sms` | `AuthApiService.smsLogin()`           | `/auth/login/sms` |
| `/sms/send`  | `AuthApiService.sendSmsCode()`        | `/auth/sms/send`  |
| `/logout`    | å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨                               | æ— ï¼ˆå·²ç§»é™¤ä»£ç†ï¼‰          |
| `/refresh`   | å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨                               | æ— ï¼ˆå·²ç§»é™¤ä»£ç†ï¼‰          |
| -            | `AuthApiService.getCurrentUserInfo()` | ä»…å†…éƒ¨ä¸šåŠ¡ä½¿ç”¨           |
| -            | `AuthApiService.validateToken()`      | ä»…å†…éƒ¨ä¸šåŠ¡ä½¿ç”¨           |

## ğŸ”„ è°ƒç”¨æµç¨‹

### é‡æ„å‰ï¼ˆFeignï¼‰

```
å®¢æˆ·ç«¯ â†’ auth-app â†’ Feign â†’ auth-app-auth
```

### é‡æ„åï¼ˆç›´æ¥è°ƒç”¨ + å†…éƒ¨æ”¯æŒï¼‰

```
# è®¤è¯ç›¸å…³è¯·æ±‚
å®¢æˆ·ç«¯ â†’ auth-app-auth(/auth/* æˆ– /client/auth/*)

# ä¸šåŠ¡ç›¸å…³è¯·æ±‚ï¼ˆéœ€è¦æ—¶å†…éƒ¨è°ƒç”¨è®¤è¯æœåŠ¡ï¼‰
å®¢æˆ·ç«¯ â†’ auth-app â†’ AuthApiService â†’ auth-app-auth(/client/auth/*)
```

## âœ… éªŒè¯æ¸…å•

- [x] åˆ é™¤åŸæœ‰Feignå®¢æˆ·ç«¯æ–‡ä»¶
- [x] åˆ›å»ºæ–°çš„RestTemplateæœåŠ¡
- [x] åˆ é™¤å¤šä½™çš„è®¤è¯ä»£ç†æ§åˆ¶å™¨ï¼ˆä¼˜åŒ–ï¼‰
- [x] åœ¨auth-app-authä¸­æ·»åŠ å¯¹å¤–æ¥å£
- [x] æ›´æ–°é…ç½®æ–‡ä»¶
- [x] ç§»é™¤Feignç›¸å…³ä¾èµ–
- [x] ç²¾ç®€æ¶æ„ï¼ŒèŒè´£æ›´æ¸…æ™°
- [x] ç¼–è¯‘æ£€æŸ¥æ— é”™è¯¯

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

1. **èŒè´£æ›´æ¸…æ™°**: è®¤è¯é€»è¾‘å®Œå…¨å½’å±è®¤è¯æ¨¡å—
2. **ä¾èµ–æ›´ç®€å•**: ç§»é™¤å¤æ‚çš„Feigné…ç½®
3. **æ§åˆ¶æ›´çµæ´»**: RestTemplateæä¾›æ›´å¥½çš„æ§åˆ¶ç²’åº¦
4. **é”™è¯¯å¤„ç†æ›´å®Œå–„**: è‡ªå®šä¹‰é™çº§ç­–ç•¥
5. **å¯ç»´æŠ¤æ€§æ›´å¼º**: é›†ä¸­çš„è®¤è¯æœåŠ¡ç®¡ç†

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: è€ƒè™‘æ·»åŠ è¿æ¥æ± é…ç½®
2. **ç›‘æ§å®Œå–„**: æ·»åŠ è°ƒç”¨é“¾è·¯ç›‘æ§
3. **å®‰å…¨åŠ å›º**: æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯
4. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°APIæ–‡æ¡£å’Œéƒ¨ç½²æ–‡æ¡£

---

**é‡æ„å®Œæˆæ—¶é—´**: 2024-01-15  
**ç‰ˆæœ¬**: v4.1.0  
**è´Ÿè´£äºº**: xypaiå›¢é˜Ÿ
