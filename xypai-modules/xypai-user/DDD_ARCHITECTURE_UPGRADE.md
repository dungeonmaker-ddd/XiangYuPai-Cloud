# ğŸš€ XyPai-User DDDæ¶æ„å‡çº§æŒ‡å—

> å°†xypai-userä»ç®€å•CRUDæœåŠ¡å‡çº§ä¸ºsfbx-insuranceåŒç­‰çº§çš„DDDèšåˆæ ¹æ¶æ„

## ğŸ“Š å‡çº§æ¦‚è§ˆ

### ğŸ¯ **å‡çº§ç›®æ ‡**

- âœ… **DDDèšåˆæ ¹æ¶æ„** - 6ä¸ªèšåˆæ ¹è®¾è®¡
- âœ… **é¢†åŸŸäº‹ä»¶æœºåˆ¶** - å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æ¶æ„
- âœ… **ä¸šåŠ¡è§„åˆ™å°è£…** - èšåˆæ ¹å†…å°è£…ä¸šåŠ¡é€»è¾‘
- âœ… **ç°ä»£åŒ–å¼€å‘è§„èŒƒ** - ä¸¥æ ¼éµå¾ªRecordsä¼˜å…ˆã€Fail Fastç­‰åŸåˆ™

### ğŸ—ï¸ **æ¶æ„å¯¹æ¯”**

| ç‰¹æ€§        | å‡çº§å‰        | å‡çº§å     |
|-----------|------------|---------|
| **æ¶æ„æ¨¡å¼**  | ç®€å•ä¸‰å±‚æ¶æ„     | DDDå››å±‚æ¶æ„ |
| **ä¸šåŠ¡å»ºæ¨¡**  | è´«è¡€æ¨¡å‹       | èšåˆæ ¹æ¨¡å‹   |
| **äº‹ä»¶æœºåˆ¶**  | æ—           | å®Œæ•´é¢†åŸŸäº‹ä»¶  |
| **ä¸šåŠ¡è§„åˆ™**  | æ•£è½åœ¨Service | å°è£…åœ¨èšåˆæ ¹  |
| **æ•°æ®ä¸€è‡´æ€§** | æ•°æ®åº“çº¦æŸ      | èšåˆæ ¹ä¿è¯   |
| **æ‰©å±•æ€§**   | æœ‰é™         | é«˜åº¦å¯æ‰©å±•   |

## ğŸ“ˆ ç¬¬ä¸€é˜¶æ®µæˆæœ âœ…

### ğŸ”¸ **å·²å®ŒæˆåŠŸèƒ½**

#### 1ï¸âƒ£ **ç”¨æˆ·èšåˆæ ¹ (UserAggregate)**

```java
// ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- ç”¨æˆ·åŸºç¡€ä¿¡æ¯ç®¡ç†
- ä¸šåŠ¡è§„åˆ™éªŒè¯ï¼ˆæ‰‹æœºå·ã€æ˜µç§°ã€å®¢æˆ·ç«¯ç±»å‹ç­‰ï¼‰
- çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- é¢†åŸŸäº‹ä»¶å‘å¸ƒï¼ˆUserCreated, UserUpdatedï¼‰
- ä¸å¯å˜è®¾è®¡ï¼Œåªé€šè¿‡æ–¹æ³•ä¿®æ”¹çŠ¶æ€
```

#### 2ï¸âƒ£ **ç¤¾äº¤èšåˆæ ¹ (SocialAggregate)**

```java
// ğŸ¤ ç¤¾äº¤åŠŸèƒ½
- å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ·
- ç²‰ä¸å…³ç³»ç®¡ç†
- ç¤¾äº¤è®¾ç½®é…ç½®
- å…³æ³¨å…³ç³»éªŒè¯ï¼ˆä¸èƒ½å…³æ³¨è‡ªå·±ã€é‡å¤å…³æ³¨ç­‰ï¼‰
- ç¤¾äº¤ç»Ÿè®¡ï¼ˆå…³æ³¨æ•°ã€ç²‰ä¸æ•°ï¼‰
```

#### 3ï¸âƒ£ **é¢†åŸŸäº‹ä»¶æœºåˆ¶**

```java
// ğŸ”” äº‹ä»¶ç±»å‹
- UserCreatedEvent      // ç”¨æˆ·åˆ›å»º
- UserUpdatedEvent      // ç”¨æˆ·æ›´æ–°
- UserFollowedEvent     // ç”¨æˆ·å…³æ³¨
- UserUnfollowedEvent   // å–æ¶ˆå…³æ³¨
- DomainEventPublisher  // äº‹ä»¶å‘å¸ƒå™¨
```

#### 4ï¸âƒ£ **åº”ç”¨æœåŠ¡å±‚**

```java
// ğŸ¯ ç¼–æ’ä¸šåŠ¡æµç¨‹
- UserApplicationService   // ç”¨æˆ·ä¸šåŠ¡ç¼–æ’
- SocialApplicationService // ç¤¾äº¤ä¸šåŠ¡ç¼–æ’
- äº‹åŠ¡ç®¡ç†å’Œäº‹ä»¶å‘å¸ƒ
- è·¨èšåˆæ ¹åè°ƒ
```

#### 5ï¸âƒ£ **åŸºç¡€è®¾æ–½å±‚**

```java
// ğŸ—ï¸ æŠ€æœ¯å®ç°
- UserRepositoryImpl       // ç”¨æˆ·ä»“å‚¨å®ç°
- DomainEventPublisherImpl // äº‹ä»¶å‘å¸ƒå®ç°
- èšåˆæ ¹ä¸å®ä½“è½¬æ¢
- Springäº‹ä»¶æœºåˆ¶é›†æˆ
```

### ğŸ”¸ **æ–°å¢APIæ¥å£**

#### ğŸ‘¤ **ç”¨æˆ·ç®¡ç†æ¥å£**

```http
POST   /api/users              # åˆ›å»ºç”¨æˆ·
GET    /api/users/{userId}     # æŸ¥è¯¢ç”¨æˆ·
PUT    /api/users/{userId}     # æ›´æ–°ç”¨æˆ·
PUT    /api/users/{userId}/enable   # å¯ç”¨ç”¨æˆ·
PUT    /api/users/{userId}/disable  # ç¦ç”¨ç”¨æˆ·
GET    /api/users/check/mobile      # æ£€æŸ¥æ‰‹æœºå·
GET    /api/users/check/username    # æ£€æŸ¥ç”¨æˆ·å
```

#### ğŸ¤ **ç¤¾äº¤åŠŸèƒ½æ¥å£**

```http
POST   /api/social/{userId}/follow/{targetUserId}    # å…³æ³¨ç”¨æˆ·
DELETE /api/social/{userId}/follow/{targetUserId}    # å–æ¶ˆå…³æ³¨
GET    /api/social/{userId}/following/{targetUserId} # æ£€æŸ¥å…³æ³¨å…³ç³»
GET    /api/social/{userId}/stats                    # ç¤¾äº¤ç»Ÿè®¡
GET    /api/social/{userId}/following                # å…³æ³¨åˆ—è¡¨
GET    /api/social/{userId}/followers                # ç²‰ä¸åˆ—è¡¨
```

## ğŸ—ï¸ ä»£ç æ¶æ„

### ğŸ“‚ **ç›®å½•ç»“æ„**

```
xypai-user/
â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ aggregate/            # èšåˆæ ¹
â”‚   â”‚   â”œâ”€â”€ UserAggregate.java
â”‚   â”‚   â””â”€â”€ SocialAggregate.java
â”‚   â”œâ”€â”€ entity/               # å®ä½“
â”‚   â”‚   â”œâ”€â”€ FollowRelation.java
â”‚   â”‚   â””â”€â”€ SocialSettings.java
â”‚   â”œâ”€â”€ valueobject/          # å€¼å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ UserId.java
â”‚   â”‚   â””â”€â”€ SocialId.java
â”‚   â”œâ”€â”€ repository/           # ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ service/              # é¢†åŸŸæœåŠ¡
â”‚   â””â”€â”€ shared/               # é¢†åŸŸäº‹ä»¶
â”œâ”€â”€ application/              # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ service/              # åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ command/              # å‘½ä»¤å¯¹è±¡
â”œâ”€â”€ infrastructure/           # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ repository/           # ä»“å‚¨å®ç°
â”‚   â””â”€â”€ event/                # äº‹ä»¶å‘å¸ƒ
â””â”€â”€ interface/                # æ¥å£å±‚
    â”œâ”€â”€ web/                  # æ§åˆ¶å™¨
    â””â”€â”€ dto/                  # å“åº”å¯¹è±¡
```

### ğŸ¯ **DDDæ ¸å¿ƒæ¦‚å¿µåº”ç”¨**

#### ğŸ”¸ **èšåˆæ ¹ (Aggregate Root)**

```java
// âœ… å°è£…ä¸šåŠ¡è§„åˆ™
public class UserAggregate {
    public void updateProfile(...) {
        validateNickname(nickname);  // ä¸šåŠ¡è§„åˆ™éªŒè¯
        // çŠ¶æ€ä¿®æ”¹
        addDomainEvent(...);         // äº‹ä»¶å‘å¸ƒ
    }
}
```

#### ğŸ”¸ **å€¼å¯¹è±¡ (Value Object)**

```java
// âœ… ä¸å¯å˜ã€è‡ªéªŒè¯
public record UserId(Long value) {
    public UserId {
        Objects.requireNonNull(value, "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        if (value <= 0) {
            throw new IllegalArgumentException("ç”¨æˆ·IDå¿…é¡»å¤§äº0");
        }
    }
}
```

#### ğŸ”¸ **å®ä½“ (Entity)**

```java
// âœ… æœ‰æ ‡è¯†ã€æœ‰ä¸šåŠ¡è¡Œä¸º
public class FollowRelation {
    public static FollowRelation create(UserId followerId, UserId followeeId) {
        if (followerId.equals(followeeId)) {
            throw new IllegalArgumentException("ä¸èƒ½å…³æ³¨è‡ªå·±");
        }
        return new FollowRelation(...);
    }
}
```

#### ğŸ”¸ **é¢†åŸŸäº‹ä»¶ (Domain Event)**

```java
// âœ… è®°å½•ä¸šåŠ¡é‡è¦æ—¶åˆ»
public record UserFollowedEvent(
    String eventId,
    UserId followerId,
    UserId followeeId,
    Instant occurredOn
) implements DomainEvent { ... }
```

## ğŸ§ª æµ‹è¯•è¦†ç›–

### âœ… **å•å…ƒæµ‹è¯•**

- èšåˆæ ¹ä¸šåŠ¡é€»è¾‘æµ‹è¯•
- å®ä½“å’Œå€¼å¯¹è±¡æµ‹è¯•
- ä¸šåŠ¡è§„åˆ™éªŒè¯æµ‹è¯•
- é¢†åŸŸäº‹ä»¶æµ‹è¯•

### ğŸ“‹ **æµ‹è¯•ç”¨ä¾‹**

```java
@Test
public void testUserAggregateCreation() { ... }
@Test
public void testSocialAggregateFollowUser() { ... }
@Test
public void testSocialAggregateBusinessRules() { ... }
```

## ğŸ‰ å…³é”®æˆå°±

### ğŸ”¸ **ä¸šåŠ¡ä»·å€¼**

- **ğŸ¤ å®Œæ•´ç¤¾äº¤ä½“ç³»**: å…³æ³¨ã€ç²‰ä¸ã€ç¤¾äº¤è®¾ç½®
- **ğŸ”’ æ•°æ®ä¸€è‡´æ€§**: èšåˆæ ¹ä¿è¯ä¸šåŠ¡è§„åˆ™
- **ğŸ“Š å®æ—¶ç»Ÿè®¡**: å…³æ³¨æ•°ã€ç²‰ä¸æ•°å®æ—¶è®¡ç®—
- **ğŸ”” äº‹ä»¶é©±åŠ¨**: æ”¯æŒå¼‚æ­¥ä¸šåŠ¡å¤„ç†

### ğŸ”¸ **æŠ€æœ¯ä»·å€¼**

- **ğŸ—ï¸ æ¸…æ™°æ¶æ„**: èŒè´£æ˜ç¡®çš„å››å±‚æ¶æ„
- **ğŸ”„ æ˜“äºæ‰©å±•**: æ–°åŠŸèƒ½åªéœ€æ–°å¢èšåˆæ ¹
- **ğŸ›¡ï¸ ä¸šåŠ¡ä¿æŠ¤**: èšåˆæ ¹å°è£…ä¸šåŠ¡è§„åˆ™
- **ğŸ“ˆ å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–ã€ä½è€¦åˆè®¾è®¡

### ğŸ”¸ **ä»£ç è´¨é‡**

- **âœ… Recordsä¼˜å…ˆ**: æ‰€æœ‰DTOä½¿ç”¨Record
- **âœ… Fail Fast**: å‚æ•°éªŒè¯å‰ç½®
- **âœ… ä¸å¯å˜è®¾è®¡**: å€¼å¯¹è±¡å’Œå®ä½“è®¾è®¡
- **âœ… æ¸…æ™°å‘½å**: è‡ªæ–‡æ¡£åŒ–ä»£ç 

## ğŸš€ ä¸‹ä¸€é˜¶æ®µè§„åˆ’

### ğŸ“ˆ **ç¬¬äºŒé˜¶æ®µï¼šäº’åŠ¨åŠŸèƒ½æ‰©å±•** (å³å°†å¼€å§‹)

- ğŸ”¸ **äº’åŠ¨èšåˆæ ¹** - ç‚¹èµã€æ”¶è—ã€è¯„è®º
- ğŸ”¸ **åŠ¨æ€èšåˆæ ¹** - ç”¨æˆ·åŠ¨æ€å‘å¸ƒ
- ğŸ”¸ **æ€§èƒ½ä¼˜åŒ–** - ç¼“å­˜ç­–ç•¥

### ğŸ“ˆ **ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½**

- ğŸ”¸ **æ´»åŠ¨èšåˆæ ¹** - æ´»åŠ¨å‘å¸ƒå‚ä¸
- ğŸ”¸ **é’±åŒ…èšåˆæ ¹** - ç”¨æˆ·é’±åŒ…åŠŸèƒ½
- ğŸ”¸ **å®Œæ•´é›†æˆæµ‹è¯•**

---

## ğŸ’¡ å…³é”®è®¾è®¡åŸåˆ™

### ğŸ¯ **ä¸¥æ ¼éµå¾ªç°ä»£åŒ–è§„åˆ™**

- âœ… **YAGNI**: ä¸å®ç°ä¸éœ€è¦çš„åŠŸèƒ½
- âœ… **DRY**: èšåˆæ ¹å¤ç”¨ä¸šåŠ¡é€»è¾‘
- âœ… **Fail Fast**: ä¸šåŠ¡è§„åˆ™éªŒè¯å‰ç½®
- âœ… **ä¸šåŠ¡å®ç”¨å¯¼å‘**: é€‚åº¦çš„å¤æ‚åº¦è®¾è®¡

### ğŸ—ï¸ **DDDæœ€ä½³å®è·µ**

- âœ… **èšåˆè¾¹ç•Œæ¸…æ™°**: ç”¨æˆ·ã€ç¤¾äº¤åˆ†ç¦»
- âœ… **é¢†åŸŸäº‹ä»¶é©±åŠ¨**: å®Œæ•´çš„äº‹ä»¶æœºåˆ¶
- âœ… **ä»“å‚¨æŠ½è±¡**: é¢†åŸŸå±‚ä¸ä¾èµ–æŠ€æœ¯ç»†èŠ‚
- âœ… **åº”ç”¨æœåŠ¡ç¼–æ’**: è·¨èšåˆæ ¹ä¸šåŠ¡æµç¨‹

ğŸŠ **ç¬¬ä¸€é˜¶æ®µï¼šDDDåŸºç¡€æ¶æ„é‡æ„ - åœ†æ»¡å®Œæˆï¼**

> ğŸš€ **xypai-user** ç°åœ¨å…·å¤‡äº†ä¸ **sfbx-insurance** åŒç­‰çº§çš„æ¶æ„è®¾è®¡ï¼
