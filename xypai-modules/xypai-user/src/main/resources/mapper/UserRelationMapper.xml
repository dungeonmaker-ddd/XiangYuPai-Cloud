<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xypai.user.mapper.UserRelationMapper">

    <resultMap type="com.xypai.user.domain.entity.UserRelation" id="UserRelationResult">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="targetId" column="target_id"/>
        <result property="type" column="type"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- 统计用户关注数 -->
    <select id="countFollowing" parameterType="Long" resultType="Long">
        SELECT COUNT(1)
        FROM user_relation
        WHERE user_id = #{userId}
          AND type = 1
    </select>

    <!-- 统计用户粉丝数 -->
    <select id="countFollowers" parameterType="Long" resultType="Long">
        SELECT COUNT(1)
        FROM user_relation
        WHERE target_id = #{userId}
          AND type = 1
    </select>

    <!-- 检查用户关系是否存在 -->
    <select id="selectRelation" resultMap="UserRelationResult">
        SELECT id, user_id, target_id, type, created_at
        FROM user_relation
        WHERE user_id = #{userId}
          AND target_id = #{targetId}
          AND type = #{type}
        LIMIT 1
    </select>

</mapper>
