# âœ… XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ Knife4j é…ç½®å®Œæˆ

## ğŸ‰ é…ç½®æ€»è§ˆ

ç”¨æˆ·å¾®æœåŠ¡å·²æˆåŠŸé›†æˆ Knife4j API æ–‡æ¡£åŠŸèƒ½ï¼Œç°åœ¨å¯ä»¥æä¾›å®Œæ•´ã€ç¾è§‚çš„ API æ–‡æ¡£ç•Œé¢ã€‚

## ğŸ“‹ å·²å®Œæˆçš„é…ç½®

### âœ… 1. ä¾èµ–é…ç½®

- âœ… æ·»åŠ äº† `xypai-common-knif4j` ä¾èµ–
- âœ… æ·»åŠ äº† `springdoc-openapi-starter-webmvc-ui` ä¾èµ–
- âœ… ç¡®ä¿äº†æ‰€æœ‰å¿…è¦çš„ä¾èµ–å·²æ­£ç¡®å¼•å…¥

### âœ… 2. åº”ç”¨é…ç½®

- âœ… æ›´æ–°äº† `application.yml` é…ç½®æ–‡ä»¶
- âœ… é…ç½®äº†å®Œæ•´çš„ Swagger/Knife4j å‚æ•°
- âœ… è®¾ç½®äº†å¤šæ¨¡å—åˆ†ç»„æ˜¾ç¤º
- âœ… é…ç½®äº† JWT è®¤è¯æ”¯æŒ
- âœ… è®¾ç½®äº†ç¯å¢ƒå·®å¼‚åŒ–é…ç½®

### âœ… 3. API æ–‡æ¡£æ³¨è§£

- âœ… `UserController` å·²å®Œå–„ API æ–‡æ¡£æ³¨è§£
- âœ… `UserAddDTO`ã€`UserQueryDTO`ã€`UserUpdateDTO` å·²å®Œå–„æ–‡æ¡£æ³¨è§£
- âœ… `UserDetailVO`ã€`UserListVO` å·²å®Œå–„æ–‡æ¡£æ³¨è§£
- âœ… æ‰€æœ‰æ¥å£éƒ½æœ‰è¯¦ç»†çš„æè¿°å’Œç¤ºä¾‹

### âœ… 4. åˆ†ç»„é…ç½®

- âœ… **01-ç”¨æˆ·åŸºç¡€æ¥å£**: `/api/v1/user/**`ï¼ˆæ’é™¤ç®¡ç†å‘˜æ¥å£ï¼‰
- âœ… **02-ç”¨æˆ·ç®¡ç†æ¥å£**: `/api/v1/user/admin/**`ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
- âœ… **03-Feignå†…éƒ¨æ¥å£**: `/api/feign/user/**`ï¼ˆå¾®æœåŠ¡é—´è°ƒç”¨ï¼‰

## ğŸš€ å¯åŠ¨å’Œè®¿é—®

### 1. å¯åŠ¨æœåŠ¡

```bash
cd xypai-users
mvn spring-boot:run
```

### 2. è®¿é—®æ–‡æ¡£

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

#### ğŸ”ª **Knife4j æ–‡æ¡£ï¼ˆæ¨èï¼‰**

```
http://localhost:9201/xypai-user/doc.html
```

#### ğŸ“– **Swagger UI æ–‡æ¡£**

```
http://localhost:9201/xypai-user/swagger-ui.html
```

#### ğŸ”— **OpenAPI JSON**

```
http://localhost:9201/xypai-user/v3/api-docs
```

## ğŸ“Š API æ¥å£ç»Ÿè®¡

### ğŸ—ï¸ ç”¨æˆ·åŸºç¡€æ¥å£ï¼ˆ31ä¸ªï¼‰

- ğŸ“Š **ç³»ç»Ÿç›‘æ§**: 1ä¸ªæ¥å£
- ğŸ“ **ç”¨æˆ·æ³¨å†Œ**: 1ä¸ªæ¥å£
- ğŸ” **ç”¨æˆ·æŸ¥è¯¢**: 8ä¸ªæ¥å£
- âœï¸ **ç”¨æˆ·æ›´æ–°**: 1ä¸ªæ¥å£
- ğŸ”„ **çŠ¶æ€ç®¡ç†**: 3ä¸ªæ¥å£
- ğŸ—‘ï¸ **ç”¨æˆ·åˆ é™¤**: 1ä¸ªæ¥å£
- ğŸ“Š **ç»Ÿè®¡æŸ¥è¯¢**: 8ä¸ªæ¥å£
- âœ… **éªŒè¯æ¥å£**: 4ä¸ªæ¥å£
- ğŸ”§ **å…¶ä»–åŠŸèƒ½**: 4ä¸ªæ¥å£

### ğŸ“š æ–‡æ¡£ç‰¹æ€§

- âœ… **å®Œæ•´çš„å‚æ•°è¯´æ˜**ï¼šæ¯ä¸ªå‚æ•°éƒ½æœ‰è¯¦ç»†æè¿°å’Œç¤ºä¾‹
- âœ… **å“åº”ç¤ºä¾‹**ï¼šæä¾›å®Œæ•´çš„å“åº”æ•°æ®ç»“æ„
- âœ… **é”™è¯¯ç è¯´æ˜**ï¼šè¯¦ç»†çš„é”™è¯¯çŠ¶æ€ç å’Œæè¿°
- âœ… **æƒé™æ ‡è¯†**ï¼šæ¸…æ™°æ ‡æ³¨æ¯ä¸ªæ¥å£çš„æƒé™è¦æ±‚
- âœ… **åˆ†ç»„å±•ç¤º**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„ï¼Œä¾¿äºæŸ¥æ‰¾
- âœ… **åœ¨çº¿è°ƒè¯•**ï¼šæ”¯æŒç›´æ¥åœ¨æ–‡æ¡£ä¸­æµ‹è¯•æ¥å£

## ğŸ” è®¤è¯é…ç½®

### JWT è®¤è¯

åœ¨ Knife4j ç•Œé¢å³ä¸Šè§’ç‚¹å‡» "Authorize"ï¼Œè¾“å…¥ï¼š

```
Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### ç¯å¢ƒé…ç½®

- ğŸŸ¢ **å¼€å‘ç¯å¢ƒ**: æ–‡æ¡£å®Œå…¨å¼€æ”¾ï¼Œæ— éœ€é¢å¤–è®¤è¯
- ğŸŸ¡ **æµ‹è¯•ç¯å¢ƒ**: å¯ç”¨åŸºç¡€è®¤è¯ä¿æŠ¤
- ğŸ”´ **ç”Ÿäº§ç¯å¢ƒ**: å®Œå…¨ç¦ç”¨æ–‡æ¡£è®¿é—®

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### ğŸ“ ç”¨æˆ·æ³¨å†Œ

- `POST /api/v1/user/register` - ç”¨æˆ·æ³¨å†Œ
- æ”¯æŒæ‰‹æœºå·ã€ç”¨æˆ·åéªŒè¯
- å®Œæ•´çš„æ•°æ®æ ¡éªŒå’Œä¸šåŠ¡è§„åˆ™

### ğŸ” ç”¨æˆ·æŸ¥è¯¢

- `GET /api/v1/user/{id}` - æ ¹æ®IDæŸ¥è¯¢
- `GET /api/v1/user/mobile/{mobile}` - æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢
- `GET /api/v1/user/page` - åˆ†é¡µæŸ¥è¯¢
- `GET /api/v1/user/vip` - VIPç”¨æˆ·æŸ¥è¯¢
- æ”¯æŒå¤šç»´åº¦æ¡ä»¶ç­›é€‰

### ğŸ“Š ç»Ÿè®¡åˆ†æ

- `GET /api/v1/user/stats/total` - ç”¨æˆ·æ€»æ•°ç»Ÿè®¡
- `GET /api/v1/user/stats/type` - ç”¨æˆ·ç±»å‹åˆ†å¸ƒ
- `GET /api/v1/user/stats/platform` - å¹³å°åˆ†å¸ƒ
- æä¾›å…¨é¢çš„æ•°æ®åˆ†ææ”¯æŒ

### âœ… æ•°æ®éªŒè¯

- `GET /api/v1/user/check/mobile` - æ‰‹æœºå·éªŒè¯
- `GET /api/v1/user/check/username` - ç”¨æˆ·åéªŒè¯
- å®æ—¶éªŒè¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

## ğŸ”§ é…ç½®è¯¦æƒ…

### Swagger é…ç½®

```yaml
swagger:
  enabled: true
  title: "XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ API"
  description: "åŸºäºä¼ä¸šæ¶æ„çš„ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡"
  version: "3.6.6"
  
  # å¤šæ¨¡å—åˆ†ç»„
  groups:
    - name: "01-ç”¨æˆ·åŸºç¡€æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/v1/user/**"
      exclude-paths:
        - "/api/v1/user/admin/**"
    
    - name: "02-ç”¨æˆ·ç®¡ç†æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/v1/user/admin/**"
    
    - name: "03-Feignå†…éƒ¨æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/feign/user/**"
  
  # JWT è®¤è¯
  authorization:
    type: "Bearer"
    name: "Authorization"
    description: "JWT è®¤è¯ä»¤ç‰Œ"
  
  # Knife4j å¢å¼º
  knife4j:
    enable: true
    production: false
    setting:
      enable-dynamic-parameter: true
      enable-debug: true
      enable-search: true
      footer-custom-content: "Â© 2025 XyPai ç”¨æˆ·å¾®æœåŠ¡"
```

## ğŸ“š ä½¿ç”¨æŒ‡å—

### 1. æŸ¥çœ‹æ¥å£æ–‡æ¡£

- è®¿é—® `/doc.html` æŸ¥çœ‹å®Œæ•´ API æ–‡æ¡£
- æŒ‰åŠŸèƒ½åˆ†ç»„æµè§ˆæ¥å£
- æŸ¥çœ‹è¯¦ç»†çš„å‚æ•°è¯´æ˜å’Œç¤ºä¾‹

### 2. åœ¨çº¿æµ‹è¯•

- ç‚¹å‡»å…·ä½“æ¥å£å±•å¼€è¯¦æƒ…
- å¡«å†™å¿…è¦å‚æ•°
- ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®æµ‹è¯•æ¥å£
- æŸ¥çœ‹å“åº”ç»“æœ

### 3. è·å–è®¤è¯Token

- è°ƒç”¨ç™»å½•æ¥å£è·å– JWT Token
- åœ¨"Authorize"ä¸­é…ç½®è®¤è¯ä¿¡æ¯
- åç»­æ¥å£è°ƒç”¨å°†è‡ªåŠ¨æºå¸¦è®¤è¯å¤´

### 4. å¯¼å‡ºAPIæ–‡æ¡£

- ç‚¹å‡»"æ–‡æ¡£"èœå•
- é€‰æ‹©"ç¦»çº¿æ–‡æ¡£"
- å¯å¯¼å‡º HTMLã€Markdown ç­‰æ ¼å¼

## ğŸ› ï¸ å¼€å‘è€…å‚è€ƒ

### æ·»åŠ æ–°æ¥å£æ–‡æ¡£

```java
@Operation(summary = "æ¥å£ç®€è¿°", description = "è¯¦ç»†æè¿°")
@ApiResponses({
    @ApiResponse(responseCode = "200", description = "æˆåŠŸ"),
    @ApiResponse(responseCode = "400", description = "å‚æ•°é”™è¯¯")
})
@GetMapping("/new-api")
public R<String> newApi(@Parameter(description = "å‚æ•°è¯´æ˜") @RequestParam String param) {
    // å®ç°é€»è¾‘
}
```

### DTO æ–‡æ¡£æ³¨è§£

```java
@Schema(description = "è¯·æ±‚DTOæè¿°")
public record RequestDTO(
    @Schema(description = "å­—æ®µæè¿°", example = "ç¤ºä¾‹å€¼", required = true)
    String field
) {}
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ–‡æ¡£æ— æ³•è®¿é—®** - æ£€æŸ¥æœåŠ¡å¯åŠ¨çŠ¶æ€å’Œç«¯å£é…ç½®
2. **æ¥å£ä¸æ˜¾ç¤º** - ç¡®è®¤åŒ…æ‰«æè·¯å¾„é…ç½®æ­£ç¡®
3. **è®¤è¯å¤±è´¥** - æ£€æŸ¥ JWT Token æ ¼å¼å’Œæœ‰æ•ˆæ€§
4. **å‚æ•°éªŒè¯å¤±è´¥** - æŸ¥çœ‹æ¥å£æ–‡æ¡£ä¸­çš„å‚æ•°è¦æ±‚

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/users.log

# æŸ¥çœ‹ Swagger ç›¸å…³æ—¥å¿—
grep -i swagger logs/users.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“§ **é‚®ç®±**: user-team@xypai.com
- ğŸ“– **æ–‡æ¡£**: [API_DOCUMENTATION_GUIDE.md](./API_DOCUMENTATION_GUIDE.md)
- ğŸ› **Issue**: GitHub Issues
- ğŸ’¬ **å›¢é˜Ÿç¾¤**: XyPai-ç”¨æˆ·æœåŠ¡æŠ€æœ¯æ”¯æŒ

---

## ğŸŠ é…ç½®å®Œæˆæ€»ç»“

âœ… **ä¾èµ–é…ç½®** - å®Œæˆ  
âœ… **åº”ç”¨é…ç½®** - å®Œæˆ  
âœ… **APIæ–‡æ¡£æ³¨è§£** - å®Œæˆ  
âœ… **åˆ†ç»„è®¾ç½®** - å®Œæˆ  
âœ… **è®¤è¯é…ç½®** - å®Œæˆ  
âœ… **ä½¿ç”¨æŒ‡å—** - å®Œæˆ

**ğŸš€ ç°åœ¨å¯ä»¥å¯åŠ¨æœåŠ¡å¹¶è®¿é—® `http://localhost:9201/xypai-user/doc.html` æŸ¥çœ‹å®Œæ•´çš„APIæ–‡æ¡£ï¼**

---

**XyPai ç”¨æˆ·å¾®æœåŠ¡å›¢é˜Ÿ** Â© 2025
