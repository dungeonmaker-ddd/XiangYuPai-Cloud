# ğŸ—ï¸ XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ - ä¼ä¸šæ¶æ„å®ç°

> **åŸºäºä¼ä¸šå¾®æœåŠ¡æ¶æ„è§„èŒƒçš„ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡**
>
> é›†æˆ Spring Boot 3.x + MyBatis Plus + Redis + Nacos + ä¼ä¸šçº§é€šç”¨æ¨¡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡æ˜¯åŸºäºä¼ä¸šå¾®æœåŠ¡æ¶æ„è®¾è®¡è§„èŒƒæ„å»ºçš„ç‹¬ç«‹å¾®æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚è¯¥å¾®æœåŠ¡ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¼€å‘è§„èŒƒï¼Œé›†æˆäº†å®‰å…¨æ¡†æ¶ã€ç¼“å­˜æ¡†æ¶ã€æ—¥å¿—æ¡†æ¶ç­‰é€šç”¨æ¨¡å—ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ—ï¸ **ä¼ä¸šæ¶æ„è®¾è®¡**: ä¸¥æ ¼éµå¾ªä¼ä¸šå¾®æœåŠ¡æ¶æ„è§„èŒƒ
- ğŸ” **å®‰å…¨æ¡†æ¶é›†æˆ**: å†…ç½®æƒé™æ§åˆ¶ã€æ•°æ®æƒé™ã€æ•æ„Ÿæ•°æ®è„±æ•
- ğŸ’¾ **ç¼“å­˜ä¼˜åŒ–**: Redisç¼“å­˜æ”¯æŒï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- ğŸ“ **æ“ä½œæ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡å’Œæ—¥å¿—è®°å½•
- ğŸ¯ **æ•°æ®æƒé™**: åŸºäºéƒ¨é—¨çš„æ•°æ®æƒé™æ§åˆ¶
- ğŸ“Š **ä¸°å¯Œç»Ÿè®¡**: å¤šç»´åº¦ç”¨æˆ·æ•°æ®ç»Ÿè®¡åˆ†æ
- ğŸ”„ **åˆ†å¸ƒå¼äº‹åŠ¡**: Seataåˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ
- ğŸ“š **APIæ–‡æ¡£**: å®Œæ•´çš„OpenAPI 3.0æ–‡æ¡£

## ğŸ›ï¸ æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯æ ˆ          | ç‰ˆæœ¬     | è¯´æ˜        |
|--------------|--------|-----------|
| Spring Boot  | 3.x    | å¾®æœåŠ¡åŸºç¡€æ¡†æ¶   |
| MyBatis Plus | 3.x    | ORMæ¡†æ¶     |
| Spring Cloud | 2023.x | å¾®æœåŠ¡æ²»ç†     |
| Nacos        | 2.x    | æœåŠ¡å‘ç°ä¸é…ç½®ä¸­å¿ƒ |
| Redis        | 7.x    | ç¼“å­˜å’Œä¼šè¯å­˜å‚¨   |
| MySQL        | 8.x    | ä¸»æ•°æ®åº“      |
| Seata        | 1.x    | åˆ†å¸ƒå¼äº‹åŠ¡     |

### æ¨¡å—ä¾èµ–

```
xypai-user-microservice
â”œâ”€â”€ xypai-common-core        # æ ¸å¿ƒå·¥å…·å’ŒåŸºç¡€ç±»
â”œâ”€â”€ xypai-common-security    # å®‰å…¨æ¡†æ¶
â”œâ”€â”€ xypai-common-redis       # Redisç¼“å­˜
â”œâ”€â”€ xypai-common-log         # æ—¥å¿—æ¡†æ¶
â”œâ”€â”€ xypai-common-datascope   # æ•°æ®æƒé™
â”œâ”€â”€ xypai-common-datasource  # å¤šæ•°æ®æº
â”œâ”€â”€ xypai-common-seata       # åˆ†å¸ƒå¼äº‹åŠ¡
â”œâ”€â”€ xypai-common-swagger     # APIæ–‡æ¡£
â””â”€â”€ xypai-common-sensitive   # æ•æ„Ÿæ•°æ®è„±æ•
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
xypai-user-microservice/
â”œâ”€â”€ src/main/java/com/xypai/user/
â”‚   â”œâ”€â”€ controller/             # ğŸ›ï¸ æ§åˆ¶å™¨å±‚
â”‚   â”‚   â””â”€â”€ UserController.java
â”‚   â”œâ”€â”€ service/               # ğŸ”§ ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ IUserService.java
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚       â””â”€â”€ UserServiceImpl.java
â”‚   â”œâ”€â”€ mapper/                # ğŸ—„ï¸ æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â””â”€â”€ UserMapper.java
â”‚   â”œâ”€â”€ domain/                # ğŸ“‹ é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ entity/            # å®ä½“ç±»
â”‚   â”‚   â”‚   â””â”€â”€ User.java
â”‚   â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ UserAddDTO.java
â”‚   â”‚   â”‚   â”œâ”€â”€ UserUpdateDTO.java
â”‚   â”‚   â”‚   â””â”€â”€ UserQueryDTO.java
â”‚   â”‚   â””â”€â”€ vo/                # è§†å›¾å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ UserDetailVO.java
â”‚   â”‚       â””â”€â”€ UserListVO.java
â”‚   â”œâ”€â”€ enums/                 # ğŸ“ æšä¸¾å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ UserStatus.java
â”‚   â”‚   â”œâ”€â”€ UserType.java
â”‚   â”‚   â””â”€â”€ Gender.java
â”‚   â”œâ”€â”€ constant/              # ğŸ“‹ å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ UserConstants.java
â”‚   â””â”€â”€ UserMicroserviceApplication.java
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ mapper/                # MyBatis XMLæ˜ å°„
â”‚   â”‚   â””â”€â”€ UserMapper.xml
â”‚   â”œâ”€â”€ sql/                   # æ•°æ®åº“è„šæœ¬
â”‚   â”‚   â””â”€â”€ user_microservice_tables.sql
â”‚   â”œâ”€â”€ application.yml        # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ application-dev.yml    # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ application-prod.yml   # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ bootstrap.yml          # å¼•å¯¼é…ç½®
â”‚   â””â”€â”€ logback-spring.xml     # æ—¥å¿—é…ç½®
â”œâ”€â”€ pom.xml                    # Mavené…ç½®
â””â”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå·²å®‰è£…ï¼š

- â˜• JDK 17+
- ğŸ› ï¸ Maven 3.8+
- ğŸ—„ï¸ MySQL 8.0+
- ğŸ’¾ Redis 7.0+
- ğŸ”§ Nacos 2.0+

### 2. æ•°æ®åº“åˆå§‹åŒ–

```bash
# æ‰§è¡Œæ•°æ®åº“è„šæœ¬
mysql -u root -p < src/main/resources/sql/user_microservice_tables.sql
```

### 3. é…ç½®ä¿®æ”¹

ä¿®æ”¹ `application-dev.yml` ä¸­çš„é…ç½®ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/xypai_user_dev
    username: your_username
    password: your_password
  
  redis:
    host: localhost
    port: 6379
    password: your_redis_password
  
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
      config:
        server-addr: localhost:8848
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# å¯åŠ¨æœåŠ¡
mvn spring-boot:run
```

### 5. éªŒè¯æœåŠ¡

è®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯æœåŠ¡ï¼š

- ğŸ¥ å¥åº·æ£€æŸ¥: http://localhost:9201/xypai-user/api/v1/user/health
- ğŸ“š APIæ–‡æ¡£: http://localhost:9201/xypai-user/swagger-ui.html
- ğŸ“Š ç›‘æ§ç«¯ç‚¹: http://localhost:9201/xypai-user/actuator/health

## ğŸ“Š API æ¥å£

### æ ¸å¿ƒæ¥å£

| æ¥å£   | æ–¹æ³•   | è·¯å¾„                          | è¯´æ˜     |
|------|------|-----------------------------|--------|
| ç”¨æˆ·æ³¨å†Œ | POST | `/api/v1/user/register`     | æ³¨å†Œæ–°ç”¨æˆ·  |
| ç”¨æˆ·è¯¦æƒ… | GET  | `/api/v1/user/{id}`         | è·å–ç”¨æˆ·è¯¦æƒ… |
| ç”¨æˆ·åˆ—è¡¨ | GET  | `/api/v1/user/page`         | åˆ†é¡µæŸ¥è¯¢ç”¨æˆ· |
| æ›´æ–°ç”¨æˆ· | PUT  | `/api/v1/user`              | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| ç”¨æˆ·çŠ¶æ€ | PUT  | `/api/v1/user/status`       | æ‰¹é‡æ›´æ–°çŠ¶æ€ |
| ç”¨æˆ·å‡çº§ | PUT  | `/api/v1/user/{id}/upgrade` | å‡çº§ç”¨æˆ·ç±»å‹ |
| å®åè®¤è¯ | PUT  | `/api/v1/user/{id}/verify`  | ç”¨æˆ·å®åè®¤è¯ |

### ç»Ÿè®¡æ¥å£

| æ¥å£    | æ–¹æ³•  | è·¯å¾„                            | è¯´æ˜      |
|-------|-----|-------------------------------|---------|
| æ€»æ•°ç»Ÿè®¡  | GET | `/api/v1/user/stats/total`    | ç”¨æˆ·æ€»æ•°ç»Ÿè®¡  |
| ç±»å‹åˆ†å¸ƒ  | GET | `/api/v1/user/stats/type`     | ç”¨æˆ·ç±»å‹åˆ†å¸ƒ  |
| å¹³å°åˆ†å¸ƒ  | GET | `/api/v1/user/stats/platform` | å¹³å°åˆ†å¸ƒç»Ÿè®¡  |
| æ¸ é“ç»Ÿè®¡  | GET | `/api/v1/user/stats/channel`  | æ³¨å†Œæ¸ é“ç»Ÿè®¡  |
| åœ°åŒºåˆ†å¸ƒ  | GET | `/api/v1/user/stats/location` | åœ°åŒºåˆ†å¸ƒç»Ÿè®¡  |
| æ´»è·ƒåº¦ç»Ÿè®¡ | GET | `/api/v1/user/stats/activity` | ç”¨æˆ·æ´»è·ƒåº¦ç»Ÿè®¡ |

### éªŒè¯æ¥å£

| æ¥å£     | æ–¹æ³•  | è·¯å¾„                            | è¯´æ˜         |
|--------|-----|-------------------------------|------------|
| æ£€æŸ¥æ‰‹æœºå·  | GET | `/api/v1/user/check/mobile`   | éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨  |
| æ£€æŸ¥ç”¨æˆ·å  | GET | `/api/v1/user/check/username` | éªŒè¯ç”¨æˆ·åæ˜¯å¦å­˜åœ¨  |
| æ£€æŸ¥é‚®ç®±   | GET | `/api/v1/user/check/email`    | éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨   |
| æ£€æŸ¥ç”¨æˆ·ç¼–ç  | GET | `/api/v1/user/check/code`     | éªŒè¯ç”¨æˆ·ç¼–ç æ˜¯å¦å­˜åœ¨ |

## ğŸ” æƒé™æ§åˆ¶

### æƒé™åˆ—è¡¨

| æƒé™ç             | è¯´æ˜       |
|----------------|----------|
| `user:query`   | æŸ¥è¯¢ç”¨æˆ·æƒé™   |
| `user:add`     | æ·»åŠ ç”¨æˆ·æƒé™   |
| `user:edit`    | ç¼–è¾‘ç”¨æˆ·æƒé™   |
| `user:remove`  | åˆ é™¤ç”¨æˆ·æƒé™   |
| `user:status`  | ç”¨æˆ·çŠ¶æ€ç®¡ç†æƒé™ |
| `user:upgrade` | ç”¨æˆ·å‡çº§æƒé™   |
| `user:verify`  | ç”¨æˆ·å®åè®¤è¯æƒé™ |

### æ•°æ®æƒé™

æ”¯æŒåŸºäºéƒ¨é—¨çš„æ•°æ®æƒé™æ§åˆ¶ï¼š

- ä½¿ç”¨ `@DataScope` æ³¨è§£è‡ªåŠ¨è¿‡æ»¤æ•°æ®
- æ”¯æŒéƒ¨é—¨çº§åˆ«çš„æ•°æ®éš”ç¦»
- ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®

## ğŸ’¾ ç¼“å­˜ç­–ç•¥

### ç¼“å­˜é”®è§„åˆ™

| ç¼“å­˜ç±»å‹ | é”®æ¨¡å¼                              | è¿‡æœŸæ—¶é—´ |
|------|----------------------------------|------|
| ç”¨æˆ·ä¿¡æ¯ | `xypai:user:info:{userId}`       | 30åˆ†é’Ÿ |
| ç”¨æˆ·ç¼–ç  | `xypai:user:code:{userCode}`     | 30åˆ†é’Ÿ |
| æ‰‹æœºå·  | `xypai:user:mobile:{mobile}`     | 30åˆ†é’Ÿ |
| ç”¨æˆ·å  | `xypai:user:username:{username}` | 30åˆ†é’Ÿ |
| ç»Ÿè®¡æ•°æ® | `xypai:user:stats:{type}`        | 60åˆ†é’Ÿ |

### ç¼“å­˜æ›´æ–°

- ç”¨æˆ·ä¿¡æ¯å˜æ›´æ—¶è‡ªåŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜
- ç»Ÿè®¡æ•°æ®å®šæ—¶åˆ·æ–°
- æ”¯æŒç¼“å­˜é¢„çƒ­å’Œæ‰¹é‡æ¸…é™¤

## ğŸ“ æ“ä½œæ—¥å¿—

### æ—¥å¿—è®°å½•

ä½¿ç”¨ `@Log` æ³¨è§£è‡ªåŠ¨è®°å½•æ“ä½œï¼š

```java
@Log(title = "ç”¨æˆ·æ³¨å†Œ", businessType = BusinessType.INSERT)
public R<User> registerUser(@Valid @RequestBody UserAddDTO addDTO) {
    // ä¸šåŠ¡é€»è¾‘
}
```

### æ—¥å¿—ç±»å‹

- `INSERT`: æ–°å¢æ“ä½œ
- `UPDATE`: æ›´æ–°æ“ä½œ
- `DELETE`: åˆ é™¤æ“ä½œ
- `QUERY`: æŸ¥è¯¢æ“ä½œ
- `OTHER`: å…¶ä»–æ“ä½œ

## ğŸ› ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

```yaml
# æ•°æ®åº“é…ç½®
spring:
  datasource:
    url: æ•°æ®åº“è¿æ¥URL
    username: æ•°æ®åº“ç”¨æˆ·å
    password: æ•°æ®åº“å¯†ç 
    hikari:
      maximum-pool-size: è¿æ¥æ± æœ€å¤§è¿æ¥æ•°
      minimum-idle: è¿æ¥æ± æœ€å°ç©ºé—²è¿æ¥æ•°

# Redisé…ç½®
  redis:
    host: Redisä¸»æœº
    port: Redisç«¯å£
    password: Rediså¯†ç 
    database: Redisæ•°æ®åº“ç´¢å¼•

# Nacosé…ç½®
  cloud:
    nacos:
      discovery:
        server-addr: NacosæœåŠ¡å‘ç°åœ°å€
        namespace: å‘½åç©ºé—´
        group: åˆ†ç»„
      config:
        server-addr: Nacosé…ç½®ä¸­å¿ƒåœ°å€
        namespace: å‘½åç©ºé—´
        group: åˆ†ç»„

# è‡ªå®šä¹‰é…ç½®
xypai:
  user:
    config:
      default-avatar: é»˜è®¤å¤´åƒURL
      user-code-prefix: ç”¨æˆ·ç¼–ç å‰ç¼€
      initial-points: åˆå§‹ç§¯åˆ†
      cache-expire-minutes: ç¼“å­˜è¿‡æœŸæ—¶é—´
    rules:
      batch-max-size: æ‰¹é‡æ“ä½œæœ€å¤§æ•°é‡
      page-max-size: åˆ†é¡µæœ€å¤§é¡µå¤§å°
      active-user-days: æ´»è·ƒç”¨æˆ·å®šä¹‰å¤©æ•°
      new-user-days: æ–°ç”¨æˆ·å®šä¹‰å¤©æ•°
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
mvn test

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn test jacoco:report
```

### é›†æˆæµ‹è¯•

```bash
# è¿è¡Œé›†æˆæµ‹è¯•
mvn integration-test
```

### APIæµ‹è¯•

ä½¿ç”¨æä¾›çš„ HTTP è¯·æ±‚æ–‡ä»¶è¿›è¡ŒAPIæµ‹è¯•ï¼š

```bash
# ä½¿ç”¨ IDEA HTTP Client æˆ– Postman å¯¼å…¥æµ‹è¯•
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

- ç”¨æˆ·æ³¨å†Œé‡
- æ´»è·ƒç”¨æˆ·æ•°
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡
- ç¼“å­˜å‘½ä¸­ç‡
- æ•°æ®åº“è¿æ¥æ± çŠ¶æ€

### ç›‘æ§ç«¯ç‚¹

- `/actuator/health` - å¥åº·æ£€æŸ¥
- `/actuator/metrics` - æ€§èƒ½æŒ‡æ ‡
- `/actuator/prometheus` - PrometheusæŒ‡æ ‡
- `/actuator/info` - åº”ç”¨ä¿¡æ¯

## ğŸ”§ è¿ç»´æŒ‡å—

### éƒ¨ç½²å»ºè®®

1. **èµ„æºé…ç½®**:
    - æœ€å°é…ç½®ï¼š2C4G
    - æ¨èé…ç½®ï¼š4C8G
    - ç”Ÿäº§é…ç½®ï¼š8C16G

2. **JVMå‚æ•°**:
   ```bash
   -Xms2g -Xmx4g 
   -XX:+UseG1GC 
   -XX:MaxGCPauseMillis=200
   ```

3. **æ•°æ®åº“è¿æ¥æ± **:
    - å¼€å‘ç¯å¢ƒï¼š5-10è¿æ¥
    - æµ‹è¯•ç¯å¢ƒï¼š10-20è¿æ¥
    - ç”Ÿäº§ç¯å¢ƒï¼š20-50è¿æ¥

### æ€§èƒ½ä¼˜åŒ–

1. **æŸ¥è¯¢ä¼˜åŒ–**:
    - åˆç†ä½¿ç”¨ç´¢å¼•
    - é¿å…N+1æŸ¥è¯¢
    - ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢

2. **ç¼“å­˜ä¼˜åŒ–**:
    - çƒ­ç‚¹æ•°æ®ç¼“å­˜
    - ç¼“å­˜é¢„çƒ­
    - ç¼“å­˜ç©¿é€é˜²æŠ¤

3. **è¿æ¥æ± ä¼˜åŒ–**:
    - åˆç†è®¾ç½®è¿æ¥æ± å¤§å°
    - ç›‘æ§è¿æ¥æ± çŠ¶æ€
    - å®šæœŸæ¸…ç†ç©ºé—²è¿æ¥

## ğŸ†˜ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**:
    - æ£€æŸ¥æ•°æ®åº“è¿æ¥
    - æ£€æŸ¥Redisè¿æ¥
    - æ£€æŸ¥Nacosè¿æ¥
    - æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

2. **APIå“åº”ç¼“æ…¢**:
    - æ£€æŸ¥æ•°æ®åº“æ€§èƒ½
    - æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
    - åˆ†æSQLæ‰§è¡Œè®¡åˆ’
    - ç›‘æ§JVMå†…å­˜

3. **æ•°æ®ä¸ä¸€è‡´**:
    - æ£€æŸ¥åˆ†å¸ƒå¼äº‹åŠ¡
    - éªŒè¯ç¼“å­˜æ›´æ–°
    - ç¡®è®¤æ•°æ®åŒæ­¥

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/xypai-user-microservice.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/xypai-user-microservice-error.log

# æŸ¥çœ‹ä¸šåŠ¡æ—¥å¿—
tail -f logs/xypai-user-microservice-business.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“§ é‚®ç®±: tech@xypai.com
- ğŸ“± å¾®ä¿¡: XyPai_Tech
- ğŸ”— æ–‡æ¡£: https://docs.xypai.com
- ğŸ› é—®é¢˜åé¦ˆ: https://github.com/xypai/issues

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) è®¸å¯è¯ã€‚

---

**ğŸ—ï¸ XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ - ä¼ä¸šçº§æ¶æ„ï¼Œå€¼å¾—ä¿¡èµ–ï¼**
