# ==========================================
# ðŸšª ç½‘å…³æœåŠ¡é…ç½® - MVPç‰ˆæœ¬
# ç«¯å£ï¼š8080
# ç‰¹ç‚¹ï¼šæ— /apiå‰ç¼€ï¼ŒçŽ°ä»£åŒ–è·¯ç”±
# ==========================================

server:
  port: 8080

spring:
  application:
    name: gateway-service
  
  # æœåŠ¡å‘çŽ°
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: xypai
        group: gateway-group
    
    # Gatewayé…ç½®
    gateway:
      # å…¨å±€CORSé…ç½®
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: "*"
            allowed-methods: "*"
            allowed-headers: "*"
            allow-credentials: true
      
      # è·¯ç”±é…ç½® - MVPç‰ˆæœ¬
      routes:
        # ðŸ‘¤ ç”¨æˆ·æœåŠ¡è·¯ç”±
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/users/**
          filters:
            - StripPrefix=0
            - AddRequestHeader=X-Service-Name, user-service
            - AddRequestHeader=X-Request-Source, gateway
        
        # ðŸ¤ ç¤¾äº¤æœåŠ¡è·¯ç”± (é¢„ç•™)
        - id: social-service
          uri: lb://social-service
          predicates:
            - Path=/social/**
          filters:
            - StripPrefix=0
            - AddRequestHeader=X-Service-Name, social-service
        
        # ðŸ’° é’±åŒ…æœåŠ¡è·¯ç”± (é¢„ç•™)
        - id: wallet-service
          uri: lb://wallet-service
          predicates:
            - Path=/wallets/**
          filters:
            - StripPrefix=0
            - AddRequestHeader=X-Service-Name, wallet-service
        
        # ðŸ“± åŠ¨æ€æœåŠ¡è·¯ç”± (é¢„ç•™)
        - id: feed-service
          uri: lb://feed-service
          predicates:
            - Path=/feeds/**
          filters:
            - StripPrefix=0
            - AddRequestHeader=X-Service-Name, feed-service

# æ—¥å¿—é…ç½®
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    com.xypai: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level [%logger{36}] - %msg%n"

# ç›‘æŽ§ç«¯ç‚¹
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
  info:
    env:
      enabled: true

# åº”ç”¨ä¿¡æ¯
info:
  app:
    name: '@project.name@'
    version: '@project.version@'
    description: ðŸšª ç½‘å…³æœåŠ¡ - MVPç‰ˆæœ¬
    port: 8080
    routes:
      - /users/** -> user-service:9106
      - /social/** -> social-service:9107
      - /wallets/** -> wallet-service:9108
      - /feeds/** -> feed-service:9109
