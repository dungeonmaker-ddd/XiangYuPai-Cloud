# ğŸ—ï¸ XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ç”Ÿäº§ç¯å¢ƒé…ç½®

spring:
  # åŠ¨æ€æ•°æ®æºé…ç½® - ç”Ÿäº§ç¯å¢ƒ
  datasource:
    dynamic:
      datasource:
        master:
          url: jdbc:mysql://${DB_HOST:xypai-mysql.prod.com}:${DB_PORT:3306}/users?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
          username: ${DB_USERNAME:xypai_user}
          password: ${DB_PASSWORD}
          hikari:
            maximum-pool-size: 50
            minimum-idle: 10
            connection-timeout: 20000
            validation-timeout: 3000
            idle-timeout: 600000
            max-lifetime: 1800000
            leak-detection-threshold: 60000
  
  # Redisé…ç½® - ç”Ÿäº§ç¯å¢ƒ
  redis:
    host: ${REDIS_HOST:xypai-redis.prod.com}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD}
    database: 0
    timeout: 10s
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
        max-wait: 10s
  
  # Nacosé…ç½® - ç”Ÿäº§ç¯å¢ƒ
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER:xypai-nacos.prod.com:8848}
        namespace: prod
        group: XYPAI_PROD_GROUP
        cluster-name: xypai-prod-cluster
        metadata:
          zone: prod-zone-1
          version: 3.6.6
      config:
        server-addr: ${NACOS_SERVER:xypai-nacos.prod.com:8848}
        namespace: prod
        group: XYPAI_PROD_GROUP

# MyBatis Plus - ç”Ÿäº§ç¯å¢ƒ
mybatis-plus:
  configuration:
    # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    # ç”Ÿäº§ç¯å¢ƒå¯ç”¨ç¼“å­˜
    cache-enabled: true
  global-config:
    # ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§èƒ½ä¼˜åŒ–
    db-config:
      logic-delete-field: delFlag

# å®‰å…¨é…ç½® - ç”Ÿäº§ç¯å¢ƒ
security:
  token:
    # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ›´å¼ºçš„å¯†é’¥
    secret: ${JWT_SECRET}
    # ç”Ÿäº§ç¯å¢ƒTokenè¿‡æœŸæ—¶é—´
    expireTime: 60

# æ—¥å¿—é…ç½® - ç”Ÿäº§ç¯å¢ƒ
logging:
  level:
    root: warn
    com.xypai: info
    org.springframework.cloud: warn
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId}] %logger{50} - %msg%n"
  file:
    name: /app/logs/users.log
    max-size: 100MB
    max-history: 30

# SpringDoc - ç”Ÿäº§ç¯å¢ƒ
springdoc:
  api-docs:
    # ç”Ÿäº§ç¯å¢ƒå…³é—­APIæ–‡æ¡£
    enabled: false
  swagger-ui:
    enabled: false

# ç›‘æ§ - ç”Ÿäº§ç¯å¢ƒ
management:
  endpoints:
    web:
      exposure:
        # ç”Ÿäº§ç¯å¢ƒåªæš´éœ²å¿…è¦çš„ç«¯ç‚¹
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
        step: 60s

# è‡ªå®šä¹‰é…ç½® - ç”Ÿäº§ç¯å¢ƒ
xypai:
  user:
    config:
      # ç”Ÿäº§ç¯å¢ƒç¼“å­˜æ—¶é—´
      cache-expire-minutes: 60
      # ç”Ÿäº§ç¯å¢ƒå…³é—­è¯¦ç»†æ—¥å¿—
      enable-detail-log: false
    rules:
      # ç”Ÿäº§ç¯å¢ƒä¸¥æ ¼é™åˆ¶æ‰¹é‡æ“ä½œ
      batch-max-size: 500
      page-max-size: 50
