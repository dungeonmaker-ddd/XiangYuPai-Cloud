# ğŸ—ï¸ XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡é…ç½® - ä¼ä¸šæ¶æ„å®ç°
# éµå¾ªä¼ä¸šå¾®æœåŠ¡æ¶æ„è§„èŒƒçš„å®Œæ•´é…ç½®

server:
  port: 9201
  servlet:
    context-path: /xypai-user

spring:
  application:
    name: users
  
  profiles:
    active: dev
  
  # ================================
  # ğŸ—„ï¸ åŠ¨æ€æ•°æ®æºé…ç½®
  # ================================
  datasource:
    dynamic:
      primary: master # è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„
      strict: false   # ä¸¥æ ¼åŒ¹é…æ•°æ®æºï¼Œé»˜è®¤falseï¼ŒtrueæœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶æŠ›å¼‚å¸¸ï¼Œfalseä½¿ç”¨é»˜è®¤æ•°æ®æº
      datasource:
        master:
          type: com.zaxxer.hikari.HikariDataSource
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/users?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
          username: ${DB_USERNAME:root}
          password: ${DB_PASSWORD:password}
          hikari:
            minimum-idle: 5
            maximum-pool-size: 20
            auto-commit: true
            idle-timeout: 30000
            pool-name: XyPaiUserHikariCP
            max-lifetime: 1800000
            connection-timeout: 30000
            connection-test-query: SELECT 1
  
  # ================================
  # ğŸ’¾ Redisç¼“å­˜é…ç½®
  # ================================
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DB:0}
    timeout: 10s
    lettuce:
      pool:
        min-idle: 0
        max-idle: 8
        max-active: 8
        max-wait: -1ms
  
  # ================================
  # â˜ï¸ Nacosé…ç½®
  # ================================
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER:localhost:8848}
        namespace: ${NACOS_NAMESPACE:public}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        cluster-name: ${NACOS_CLUSTER:DEFAULT}
        metadata:
          version: 3.6.6
          zone: xypai-zone
      config:
        server-addr: ${NACOS_SERVER:localhost:8848}
        namespace: ${NACOS_NAMESPACE:public}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        file-extension: yml
        shared-configs:
          - data-id: application-common.yml
            group: DEFAULT_GROUP
            refresh: true
          - data-id: xypai-common-redis.yml
            group: DEFAULT_GROUP
            refresh: true
          - data-id: xypai-common-security.yml
            group: DEFAULT_GROUP
            refresh: true

# ================================
# ğŸ§© MyBatis Plusé…ç½®
# ================================
mybatis-plus:
  # Mapper XMLæ–‡ä»¶è·¯å¾„
  mapper-locations: classpath*:mapper/**/*Mapper.xml
  # å®ä½“ç±»åŒ…è·¯å¾„
  type-aliases-package: com.xypai.user.domain.entity
  # å…¨å±€é…ç½®
  global-config:
    # æ•°æ®åº“å­—æ®µé©¼å³°ä¸‹åˆ’çº¿è½¬æ¢
    db-config:
      # ä¸»é”®ç­–ç•¥
      id-type: ASSIGN_ID
      # é€»è¾‘åˆ é™¤å­—æ®µ
      logic-delete-field: delFlag
      # é€»è¾‘åˆ é™¤å€¼
      logic-delete-value: 1
      # é€»è¾‘æœªåˆ é™¤å€¼
      logic-not-delete-value: 0
      # å­—æ®µç­–ç•¥
      insert-strategy: NOT_NULL
      update-strategy: NOT_NULL
      select-strategy: NOT_EMPTY
  # MyBatisé…ç½®
  configuration:
    # é©¼å³°ä¸‹åˆ’çº¿è½¬æ¢
    map-underscore-to-camel-case: true
    # ç¼“å­˜é…ç½®
    cache-enabled: false
    # SQLæ—¥å¿—
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # æ‡’åŠ è½½é…ç½®
    lazy-loading-enabled: true
    multiple-result-sets-enabled: true
    use-column-label: true
    use-generated-keys: false
    auto-mapping-behavior: partial
    default-executor-type: simple
    default-statement-timeout: 25000

# ================================
# ğŸ” å®‰å…¨é…ç½®
# ================================
security:
  # Tokené…ç½®
  token:
    header: Authorization
    prefix: "Bearer "
    secret: ${JWT_SECRET:xypai-user-microservice-secret-key-2025}
    expireTime: 30

# ================================
# ğŸ“ æ—¥å¿—é…ç½®
# ================================
logging:
  level:
    com.xypai: debug
    org.springframework.cloud: info
    org.mybatis: debug
  file:
    name: logs/users.log

# ================================
# ğŸ“Š ç›‘æ§é…ç½® - Actuator
# ================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true

# SpringDoc è¢« Knife4j æ›¿ä»£ï¼Œæ— éœ€é…ç½®

# ================================
# ğŸ¯ Feigné…ç½®
# ================================
feign:
  compression:
    request:
      enabled: true
    response:
      enabled: true
  client:
    config:
      default:
        connect-timeout: 10000
        read-timeout: 10000
        logger-level: basic

# ================================
# ğŸ“š Knife4j APIæ–‡æ¡£é…ç½®
# ================================
swagger:
  enabled: true
  title: "XYç›¸é‡æ´¾ç”¨æˆ·å¾®æœåŠ¡ API"
  description: "åŸºäºä¼ä¸šæ¶æ„çš„ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡ - æä¾›ç”¨æˆ·æ³¨å†Œã€è®¤è¯ã€ä¿¡æ¯ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½"
  version: "3.6.6"
  
  # è”ç³»äººä¿¡æ¯
  contact:
    name: "XyPai ç”¨æˆ·æœåŠ¡å›¢é˜Ÿ"
    email: "user-team@xypai.com"
    url: "https://wiki.xypai.com/user-service"
  
  # æ‰«æé…ç½®
  base-packages:
    - "com.xypai.user.controller"
  
  # æ’é™¤æ•æ„Ÿè·¯å¾„
  exclude-paths:
    - "/actuator/**"
    - "/error"
    - "/api/feign/user/internal/**"
    - "/api/v1/user/admin/sensitive/**"
  
  # æ¨¡å—åˆ†ç»„é…ç½®
  groups:
    - name: "01-ç”¨æˆ·åŸºç¡€æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/v1/user/**"
      exclude-paths:
        - "/api/v1/user/admin/**"
        - "/api/feign/**"

    - name: "02-ç”¨æˆ·ç®¡ç†æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/v1/user/admin/**"

    - name: "03-Feignå†…éƒ¨æ¥å£"
      base-package: "com.xypai.user.controller"
      paths-to-match: "/api/feign/user/**"
  
  # JWT è®¤è¯é…ç½®
  authorization:
    type: "Bearer"
    name: "Authorization"
    description: "JWT è®¤è¯ä»¤ç‰Œï¼Œæ ¼å¼ï¼šBearer {token}"
    key-location: "header"
  
  # Knife4j å¢å¼ºé…ç½®
  knife4j:
    enable: true
    production: false
    
    # å¼€å‘ç¯å¢ƒBasicè®¤è¯ï¼ˆå¯é€‰ï¼‰
    basic:
      enable: false
      username: "xypai"
      password: "dev2025"
    
    # ç•Œé¢è‡ªå®šä¹‰
    setting:
      enable-dynamic-parameter: true
      enable-debug: true
      enable-search: true
      enable-footer-custom: true
      footer-custom-content: "Â© 2025 XyPai ç”¨æˆ·å¾®æœåŠ¡ - ä¼ä¸šçº§æ¶æ„å®ç°"
      enable-home-custom: true
      home-custom-path: "/doc.html"

# ================================
# ğŸ”§ è‡ªå®šä¹‰é…ç½®
# ================================
xypai:
  
  user:
    # ç”¨æˆ·é…ç½®
    config:
      # é»˜è®¤å¤´åƒ
      default-avatar: "https://cdn.xypai.com/avatar/default.jpg"
      # ç”¨æˆ·ç¼–ç å‰ç¼€
      user-code-prefix: "XY"
      # åˆå§‹ç§¯åˆ†
      initial-points: 100
      # ç¼“å­˜è¿‡æœŸæ—¶é—´(åˆ†é’Ÿ)
      cache-expire-minutes: 30
    # ä¸šåŠ¡è§„åˆ™é…ç½®
    rules:
      # æ‰¹é‡æ“ä½œæœ€å¤§æ•°é‡
      batch-max-size: 1000
      # åˆ†é¡µæœ€å¤§é¡µå¤§å°
      page-max-size: 100
      # æ´»è·ƒç”¨æˆ·å®šä¹‰å¤©æ•°
      active-user-days: 30
      # æ–°ç”¨æˆ·å®šä¹‰å¤©æ•°
      new-user-days: 7
